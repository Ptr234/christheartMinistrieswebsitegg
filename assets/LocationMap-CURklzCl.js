import{r as c,j as n}from"./index-BpDo7nEO.js";import{M as x,T as j,a as y,P as S,u,L as f}from"./leaflet-2ezczUGQ.js";const T=f.divIcon({className:"map-pin",html:'<div class="map-pin-inner"><span class="map-pin-cross">✟</span></div>',iconSize:[30,40],iconAnchor:[15,40],popupAnchor:[0,-40]});f.Marker.prototype.options.icon=T;function b({lat:t,lng:o,zoom:e}){const r=u();return c.useEffect(()=>{r.flyTo([t,o],e,{duration:.5})},[t,o,e,r]),null}function E(){const t=u();return c.useEffect(()=>{const o=setTimeout(()=>t.invalidateSize(),250);return()=>clearTimeout(o)},[t]),null}function M(){const t=u();return c.useEffect(()=>{if(!("ontouchstart"in window||navigator.maxTouchPoints>0))return;t.dragging.disable();const e=t.getContainer(),r=s=>{s.touches.length>=2&&t.dragging.enable()},a=()=>{setTimeout(()=>t.dragging.disable(),100)};return e.addEventListener("touchstart",r,{passive:!0}),e.addEventListener("touchend",a,{passive:!0}),()=>{e.removeEventListener("touchstart",r),e.removeEventListener("touchend",a)}},[t]),null}async function w(t){const o="locationMapCache",e=JSON.parse(localStorage.getItem(o)||"{}");if(e[t])return e[t];try{const r=`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(t)}&limit=1`,s=await(await fetch(r,{headers:{Accept:"application/json"}})).json();if(s&&s[0]){const i={lat:parseFloat(s[0].lat),lng:parseFloat(s[0].lon)};return e[t]=i,localStorage.setItem(o,JSON.stringify(e)),i}}catch{}return null}function I({address:t,label:o,height:e="250px",zoom:r=15,lat:a,lng:s}){const i=a!=null&&s!=null&&(a!==0||s!==0),[l,h]=c.useState(i?{lat:a,lng:s}:null),[g,m]=c.useState(!i);if(c.useEffect(()=>{if(i)return;let d=!0;return w(t).then(v=>{d&&(h(v),m(!1))}),()=>{d=!1}},[t,i]),g)return n.jsx("div",{style:{height:e,display:"flex",alignItems:"center",justifyContent:"center",background:"var(--purple-50)",borderRadius:"var(--radius-lg)",color:"var(--text-light)"},children:"Loading map..."});if(!l)return n.jsx("div",{style:{height:e,display:"flex",alignItems:"center",justifyContent:"center",background:"var(--purple-50)",borderRadius:"var(--radius-lg)",color:"var(--text-light)",fontSize:"0.85rem"},children:"Map unavailable for this location"});const p=[l.lat,l.lng];return n.jsxs(x,{center:p,zoom:r,style:{height:e,width:"100%",borderRadius:"var(--radius-lg)",overflow:"hidden"},scrollWheelZoom:!1,children:[n.jsx(j,{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19,crossOrigin:""}),n.jsx(E,{}),n.jsx(M,{}),n.jsx(b,{lat:l.lat,lng:l.lng,zoom:r}),n.jsx(y,{position:p,children:n.jsxs(S,{children:[n.jsx("strong",{children:o}),n.jsx("div",{children:t})]})})]})}export{I as default};
